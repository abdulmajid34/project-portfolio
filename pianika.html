<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Pianika - Abdul Majid Portfolio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .game-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .pianika-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .pianika-keyboard {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(145deg, #f0f0f0, #e0e0e0);
            border-radius: 15px;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 2px;
        }

        .note-key {
            width: 35px;
            height: 120px;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
            transition: all 0.15s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px 4px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
        }

        .note-key:hover {
            background: linear-gradient(145deg, #f0f0f0, #e0e0e0);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .note-key.active {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .note-name {
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            color: #2c3e50;
        }

        .note-key.active .note-name {
            color: white;
        }

        .keyboard-key {
            font-size: 8px;
            text-align: center;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 3px;
            padding: 2px;
            margin-top: auto;
        }

        .note-key.active .keyboard-key {
            background: rgba(255, 255, 255, 0.3);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .btn {
            margin: 5px;
            padding: 10px 20px;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: #333;
            text-decoration: none;
        }

        .music-sheets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .song-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .song-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .song-card.active {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .song-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .song-notation {
            font-family: monospace;
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            white-space: pre-wrap;
            line-height: 1.6;
            border-left: 4px solid #3498db;
        }

        .chord-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .chord-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .chord-btn {
            padding: 12px;
            border: 2px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .chord-btn:hover {
            background: #007bff;
            color: white;
            transform: translateY(-1px);
        }

        .chord-btn.active {
            background: #007bff;
            color: white;
        }

        .current-chord {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 15px 0;
            color: #2c3e50;
        }

        .chord-notes {
            text-align: center;
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 15px;
            font-family: monospace;
        }

        .recording-controls {
            text-align: center;
            margin: 20px 0;
        }

        .recording-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #dc3545;
            margin-right: 10px;
            animation: blink 1s infinite;
        }

        .recording-indicator.hidden {
            display: none;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .tempo-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .tempo-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6c757d;
            transition: background 0.1s ease;
        }

        .tempo-indicator.beat {
            background: #28a745;
        }

        .note-display {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 10px;
        }

        .current-note {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }

        .note-frequency {
            font-size: 1rem;
            color: #6c757d;
        }

        .keyboard-layout {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 10px;
        }

        .keyboard-hint {
            padding: 8px 12px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-size: 0.8rem;
            font-family: monospace;
        }

        .keyboard-hint.active {
            background: #007bff;
            color: white;
        }

        @media (max-width: 768px) {
            .pianika-keyboard {
                justify-content: flex-start;
                overflow-x: auto;
                padding: 10px;
            }

            .note-key {
                width: 30px;
                height: 100px;
                min-width: 30px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .keyboard-row {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to Portfolio
    </a>

    <div class="container game-container">
        <div class="game-header">
            <h1><i class="fas fa-music"></i> Virtual Pianika</h1>
            <p>Play pianika with full chromatic notes, chords, and popular melodies!</p>
        </div>

        <div class="pianika-container">
            <div class="controls">
                <div class="control-group">
                    <label>Volume</label>
                    <input type="range" id="volumeSlider" min="0" max="100" value="50" class="form-range">
                </div>
                <div class="control-group">
                    <label>Octave</label>
                    <select id="octaveSelect" class="form-select">
                        <option value="3">3</option>
                        <option value="4" selected>4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Tempo</label>
                    <div class="tempo-control">
                        <input type="range" id="tempoSlider" min="60" max="180" value="120" class="form-range">
                        <span id="tempoDisplay">120 BPM</span>
                        <button class="btn btn-sm btn-outline-primary" onclick="toggleTempo()">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="tempo-indicator" id="tempoIndicator"></div>
                    </div>
                </div>
            </div>

            <div class="keyboard-layout">
                <h5>Keyboard Layout</h5>
                <div class="keyboard-row">
                    <div class="keyboard-hint">1=C</div>
                    <div class="keyboard-hint">2=C#</div>
                    <div class="keyboard-hint">3=D</div>
                    <div class="keyboard-hint">4=D#</div>
                    <div class="keyboard-hint">5=E</div>
                    <div class="keyboard-hint">6=F</div>
                    <div class="keyboard-hint">7=F#</div>
                    <div class="keyboard-hint">8=G</div>
                    <div class="keyboard-hint">9=G#</div>
                    <div class="keyboard-hint">0=A</div>
                </div>
                <div class="keyboard-row">
                    <div class="keyboard-hint">Q=A#</div>
                    <div class="keyboard-hint">W=B</div>
                    <div class="keyboard-hint">E=C5</div>
                    <div class="keyboard-hint">R=C#5</div>
                    <div class="keyboard-hint">T=D5</div>
                    <div class="keyboard-hint">Y=D#5</div>
                    <div class="keyboard-hint">U=E5</div>
                    <div class="keyboard-hint">I=F5</div>
                    <div class="keyboard-hint">O=F#5</div>
                    <div class="keyboard-hint">P=G5</div>
                </div>
            </div>

            <div class="note-display">
                <div class="current-note" id="currentNote">Press a key to play</div>
                <div class="note-frequency" id="noteFreq">-</div>
            </div>

            <div class="pianika-keyboard" id="pianikaKeyboard">
                <!-- Pianika keys will be generated by JavaScript -->
            </div>

            <div class="recording-controls">
                <button class="btn btn-danger" onclick="toggleRecording()" id="recordBtn">
                    <span class="recording-indicator hidden" id="recordingIndicator"></span>
                    <i class="fas fa-circle"></i> Record
                </button>
                <button class="btn btn-success" onclick="playRecording()" id="playBtn" disabled>
                    <i class="fas fa-play"></i> Play Recording
                </button>
                <button class="btn btn-secondary" onclick="clearRecording()">
                    <i class="fas fa-trash"></i> Clear
                </button>
                <button class="btn btn-info" onclick="exportRecording()">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>

            <div class="chord-display">
                <h4>Chord Player</h4>
                <div class="current-chord" id="currentChord">Select a chord</div>
                <div class="chord-notes" id="chordNotes">-</div>
                <div class="chord-buttons" id="chordButtons">
                    <!-- Chord buttons will be generated by JavaScript -->
                </div>
            </div>

            <div class="music-sheets">
                <div class="song-card" onclick="selectSong('twinkle')">
                    <div class="song-title">Twinkle Twinkle Little Star</div>
                    <div class="song-notation">C(1) C(1) G(8) G(8) A(0) A(0) G(8)
F(6) F(6) E(5) E(5) D(3) D(3) C(1)</div>
                    <button class="btn btn-sm btn-primary" onclick="playSong('twinkle')">
                        <i class="fas fa-play"></i> Play
                    </button>
                </div>

                <div class="song-card" onclick="selectSong('happy')">
                    <div class="song-title">Happy Birthday</div>
                    <div class="song-notation">C(1) C(1) D(3) C(1) F(6) E(5)
C(1) C(1) D(3) C(1) G(8) F(6)</div>
                    <button class="btn btn-sm btn-primary" onclick="playSong('happy')">
                        <i class="fas fa-play"></i> Play
                    </button>
                </div>

                <div class="song-card" onclick="selectSong('indonesia')">
                    <div class="song-title">Indonesia Raya</div>
                    <div class="song-notation">E(5) E(5) F(6) G(8) A(0) G(8) F(6) E(5)
C(1) D(3) E(5) F(6) G(8) F(6) E(5) D(3)</div>
                    <button class="btn btn-sm btn-primary" onclick="playSong('indonesia')">
                        <i class="fas fa-play"></i> Play
                    </button>
                </div>

                <div class="song-card" onclick="selectSong('scale')">
                    <div class="song-title">C Major Scale</div>
                    <div class="song-notation">C(1) D(3) E(5) F(6) G(8) A(0) B(W) C(E)</div>
                    <button class="btn btn-sm btn-primary" onclick="playSong('scale')">
                        <i class="fas fa-play"></i> Play
                    </button>
                </div>

                <div class="song-card" onclick="selectSong('balonku')">
                    <div class="song-title">Balonku Ada Lima</div>
                    <div class="song-notation">G(8) G(8) A(0) A(0) G(8) F(6) E(5)
F(6) F(6) G(8) G(8) F(6) E(5) D(3)</div>
                    <button class="btn btn-sm btn-primary" onclick="playSong('balonku')">
                        <i class="fas fa-play"></i> Play
                    </button>
                </div>

                <div class="song-card" onclick="selectSong('gugur')">
                    <div class="song-title">Gugur Bunga</div>
                    <div class="song-notation">C(1) E(5) G(8) E(5) D(3) F(6) A(0) F(6)
E(5) G(8) B(W) G(8) F(6) A(0) C(E) A(0)</div>
                    <button class="btn btn-sm btn-primary" onclick="playSong('gugur')">
                        <i class="fas fa-play"></i> Play
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let audioContext;
        let currentOctave = 4;
        let volume = 0.5;
        let isRecording = false;
        let recording = [];
        let recordingStartTime = 0;
        let tempoInterval = null;
        let tempoActive = false;
        let tempo = 120;

        // Full chromatic scale including all notes
        const fullNotes = [
            'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B',
            'C5', 'C#5', 'D5', 'D#5', 'E5', 'F5', 'F#5', 'G5'
        ];

        // Keyboard mapping for computer keyboard
        const keyboardMap = {
            '1': 'C', '2': 'C#', '3': 'D', '4': 'D#', '5': 'E',
            '6': 'F', '7': 'F#', '8': 'G', '9': 'G#', '0': 'A',
            'q': 'A#', 'w': 'B', 'e': 'C5', 'r': 'C#5', 't': 'D5',
            'y': 'D#5', 'u': 'E5', 'i': 'F5', 'o': 'F#5', 'p': 'G5'
        };

        const chords = {
            'C Major': ['C', 'E', 'G'],
            'D Major': ['D', 'F#', 'A'],
            'E Major': ['E', 'G#', 'B'],
            'F Major': ['F', 'A', 'C5'],
            'G Major': ['G', 'B', 'D5'],
            'A Major': ['A', 'C#5', 'E5'],
            'B Major': ['B', 'D#5', 'F#5'],
            'C Minor': ['C', 'D#', 'G'],
            'D Minor': ['D', 'F', 'A'],
            'E Minor': ['E', 'G', 'B'],
            'F Minor': ['F', 'G#', 'C5'],
            'G Minor': ['G', 'A#', 'D5'],
            'A Minor': ['A', 'C5', 'E5'],
            'B Minor': ['B', 'D5', 'F#5']
        };

        const songs = {
            'twinkle': [
                {note: 'C', duration: 500, key: '1'},
                {note: 'C', duration: 500, key: '1'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'A', duration: 500, key: '0'},
                {note: 'A', duration: 500, key: '0'},
                {note: 'G', duration: 1000, key: '8'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'D', duration: 500, key: '3'},
                {note: 'D', duration: 500, key: '3'},
                {note: 'C', duration: 1000, key: '1'}
            ],
            'happy': [
                {note: 'C', duration: 400, key: '1'},
                {note: 'C', duration: 200, key: '1'},
                {note: 'D', duration: 600, key: '3'},
                {note: 'C', duration: 600, key: '1'},
                {note: 'F', duration: 600, key: '6'},
                {note: 'E', duration: 1200, key: '5'},
                {note: 'C', duration: 400, key: '1'},
                {note: 'C', duration: 200, key: '1'},
                {note: 'D', duration: 600, key: '3'},
                {note: 'C', duration: 600, key: '1'},
                {note: 'G', duration: 600, key: '8'},
                {note: 'F', duration: 1200, key: '6'}
            ],
            'indonesia': [
                {note: 'E', duration: 500, key: '5'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'A', duration: 500, key: '0'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'C', duration: 500, key: '1'},
                {note: 'D', duration: 500, key: '3'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'D', duration: 1000, key: '3'}
            ],
            'scale': [
                {note: 'C', duration: 500, key: '1'},
                {note: 'D', duration: 500, key: '3'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'A', duration: 500, key: '0'},
                {note: 'B', duration: 500, key: 'w'},
                {note: 'C5', duration: 1000, key: 'e'}
            ],
            'balonku': [
                {note: 'G', duration: 500, key: '8'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'A', duration: 500, key: '0'},
                {note: 'A', duration: 500, key: '0'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'E', duration: 1000, key: '5'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'D', duration: 1000, key: '3'}
            ],
            'gugur': [
                {note: 'C', duration: 500, key: '1'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'D', duration: 500, key: '3'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'A', duration: 500, key: '0'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'E', duration: 500, key: '5'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'B', duration: 500, key: 'w'},
                {note: 'G', duration: 500, key: '8'},
                {note: 'F', duration: 500, key: '6'},
                {note: 'A', duration: 500, key: '0'},
                {note: 'C5', duration: 500, key: 'e'},
                {note: 'A', duration: 1000, key: '0'}
            ]
        };

        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        function createPianikaKeyboard() {
            const keyboard = document.getElementById('pianikaKeyboard');
            keyboard.innerHTML = '';

            fullNotes.forEach((note, index) => {
                const key = document.createElement('div');
                key.className = 'note-key';
                key.dataset.note = note;

                // Find corresponding keyboard key
                const keyboardKey = Object.keys(keyboardMap).find(k => keyboardMap[k] === note);

                key.innerHTML = `
                    <div class="note-name">${note}</div>
                    <div class="keyboard-key">${keyboardKey || ''}</div>
                `;

                key.addEventListener('mousedown', () => playNote(note));
                key.addEventListener('mouseup', () => stopNote(note));
                key.addEventListener('mouseleave', () => stopNote(note));

                keyboard.appendChild(key);
            });
        }

        function createChordButtons() {
            const chordButtons = document.getElementById('chordButtons');
            chordButtons.innerHTML = '';

            Object.keys(chords).forEach(chordName => {
                const button = document.createElement('button');
                button.className = 'chord-btn';
                button.textContent = chordName;
                button.onclick = () => playChord(chordName);
                chordButtons.appendChild(button);
            });
        }

        function getFrequency(note) {
            const noteFreqs = {
                'C': 261.63, 'C#': 277.18, 'D': 293.66, 'D#': 311.13, 'E': 329.63,
                'F': 349.23, 'F#': 369.99, 'G': 392.00, 'G#': 415.30, 'A': 440.00,
                'A#': 466.16, 'B': 493.88, 'C5': 523.25, 'C#5': 554.37, 'D5': 587.33,
                'D#5': 622.25, 'E5': 659.25, 'F5': 698.46, 'F#5': 739.99, 'G5': 783.99
            };

            const octaveMultiplier = Math.pow(2, currentOctave - 4);
            return noteFreqs[note] * octaveMultiplier;
        }

        function playNote(note, duration = null) {
            if (!audioContext) initAudio();

            const frequency = getFrequency(note);
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = 'triangle';

            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05);

            oscillator.start();

            // Update display
            document.getElementById('currentNote').textContent = note;
            document.getElementById('noteFreq').textContent = `${frequency.toFixed(2)} Hz`;

            // Visual feedback
            const key = document.querySelector(`[data-note="${note}"]`);
            if (key) key.classList.add('active');

            // Highlight keyboard hint
            const keyboardKey = Object.keys(keyboardMap).find(k => keyboardMap[k] === note);
            if (keyboardKey) {
                const hints = document.querySelectorAll('.keyboard-hint');
                hints.forEach(hint => {
                    if (hint.textContent.includes(keyboardKey.toUpperCase())) {
                        hint.classList.add('active');
                    }
                });
            }

            if (duration) {
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration / 1000);
                oscillator.stop(audioContext.currentTime + duration / 1000);
            } else {
                key.oscillator = oscillator;
                key.gainNode = gainNode;
            }

            // Record if recording
            if (isRecording) {
                recording.push({
                    note: note,
                    time: Date.now() - recordingStartTime,
                    octave: currentOctave
                });
            }
        }

        function stopNote(note) {
            const key = document.querySelector(`[data-note="${note}"]`);
            if (key && key.oscillator) {
                key.gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                key.oscillator.stop(audioContext.currentTime + 0.1);
                key.classList.remove('active');
                key.oscillator = null;
                key.gainNode = null;
            }

            // Remove keyboard hint highlight
            const hints = document.querySelectorAll('.keyboard-hint');
            hints.forEach(hint => hint.classList.remove('active'));
        }

        function playChord(chordName) {
            const chordNotes = chords[chordName];
            document.getElementById('currentChord').textContent = chordName;
            document.getElementById('chordNotes').textContent = chordNotes.join(' - ');

            // Visual feedback
            document.querySelectorAll('.chord-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Play all notes in chord
            chordNotes.forEach((note, index) => {
                setTimeout(() => playNote(note, 2000), index * 50);
            });
        }

        function toggleRecording() {
            if (isRecording) {
                isRecording = false;
                document.getElementById('recordBtn').innerHTML = '<i class="fas fa-circle"></i> Record';
                document.getElementById('recordingIndicator').classList.add('hidden');
                document.getElementById('playBtn').disabled = recording.length === 0;
            } else {
                isRecording = true;
                recording = [];
                recordingStartTime = Date.now();
                document.getElementById('recordBtn').innerHTML = '<i class="fas fa-stop"></i> Stop';
                document.getElementById('recordingIndicator').classList.remove('hidden');
                document.getElementById('playBtn').disabled = true;
            }
        }

        function playRecording() {
            if (recording.length === 0) return;

            recording.forEach(noteEvent => {
                setTimeout(() => {
                    playNote(noteEvent.note, 500);
                }, noteEvent.time);
            });
        }

        function clearRecording() {
            recording = [];
            document.getElementById('playBtn').disabled = true;
        }

        function exportRecording() {
            if (recording.length === 0) {
                alert('No recording to export!');
                return;
            }

            const exportData = {
                title: 'My Pianika Recording',
                tempo: tempo,
                notes: recording
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'pianika-recording.json';
            link.click();
        }

        function playSong(songName) {
            const song = songs[songName];
            let currentTime = 0;

            // Clear active song cards
            document.querySelectorAll('.song-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.song-card').classList.add('active');

            song.forEach(noteEvent => {
                setTimeout(() => {
                    playNote(noteEvent.note, noteEvent.duration);
                }, currentTime);
                currentTime += noteEvent.duration;
            });
        }

        function selectSong(songName) {
            document.querySelectorAll('.song-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.song-card').classList.add('active');
        }

        function toggleTempo() {
            if (tempoActive) {
                clearInterval(tempoInterval);
                tempoActive = false;
                document.querySelector('.tempo-control button').innerHTML = '<i class="fas fa-play"></i>';
            } else {
                const interval = 60000 / tempo;
                tempoInterval = setInterval(() => {
                    const indicator = document.getElementById('tempoIndicator');
                    indicator.classList.add('beat');
                    setTimeout(() => indicator.classList.remove('beat'), 100);

                    // Play tempo click
                    if (audioContext) {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                        oscillator.type = 'sine';
                        gainNode.gain.setValueAtTime(volume * 0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                        oscillator.start();
                        oscillator.stop(audioContext.currentTime + 0.1);
                    }
                }, interval);
                tempoActive = true;
                document.querySelector('.tempo-control button').innerHTML = '<i class="fas fa-pause"></i>';
            }
        }

        // Event listeners
        document.getElementById('volumeSlider').addEventListener('input', (e) => {
            volume = e.target.value / 100;
        });

        document.getElementById('octaveSelect').addEventListener('change', (e) => {
            currentOctave = parseInt(e.target.value);
        });

        document.getElementById('tempoSlider').addEventListener('input', (e) => {
            tempo = parseInt(e.target.value);
            document.getElementById('tempoDisplay').textContent = `${tempo} BPM`;

            if (tempoActive) {
                toggleTempo();
                toggleTempo();
            }
        });

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            const note = keyboardMap[e.key.toLowerCase()];
            if (note && !e.repeat) {
                playNote(note);
            }
        });

        document.addEventListener('keyup', (e) => {
            const note = keyboardMap[e.key.toLowerCase()];
            if (note) {
                stopNote(note);
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createPianikaKeyboard();
            createChordButtons();
        });

        // Handle audio context on user interaction
        document.addEventListener('click', () => {
            if (!audioContext) {
                initAudio();
            }
        });
    </script>
</body>
</html>